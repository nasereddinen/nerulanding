{% extends request.resolver_match.page_template %}
{% load static %}
{% block content %}
    <style>
        .quantity_input {
            width: 40px;
        }
    </style>
    <div class="row page-header">
        <div class="col-lg-6 align-self-center ">
            <h2>Business Credit Building Steps You Need Done For You</h2>
        </div>
    </div>
    <div class="room">
        <section class="main-content">
            <div class="row">
                {% if dynamic.is_main_site %}
                <div class="col-md-12">
                    <iframe width="100%" height="515" src="https://www.youtube.com/embed/86-3dyRmSXw" frameborder="0"
                            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                    <h3> Watch The Introduction Video To Understand How To Use The Extension</h3>
                </div>
                {% endif %}
            </div>
            <div class="row justify-content-center">
                <div class="card">
                    <div class="card-body">
                        <form method="post" id="business-programm">{% csrf_token %}</form>
                        <form method="post" id="business_builder_program_year_form">{% csrf_token %}</form>
                        <form method="post" id="steps-form">{% csrf_token %}
                            <div class="row mb-2">
                                <div class="col-6">
                                    {{ form.first_name.label_tag }}{{ form.first_name }}
                                </div>
                                <div class="col-6">
                                    {{ form.last_name.label_tag }}{{ form.last_name }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-12">
                                    {{ form.email.label_tag }}{{ form.email }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-12">
                                    {{ form.phone.label_tag }}{{ form.phone }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-12 font-weight-bold">
                                    Choose The Business Credit Building Steps From The List That You Need
                                </div>
                            </div>
                            <div class="row mb-2 justify-content-center">
                                <div class="card bg-gray m-2 " style="width: 30rem;">
                                    <div class="card-body">
                                        <div class="text-center mb-2 font-weight-bold">
                                            Monthly Options
                                        </div>

                                        {% if user_steps.website %}
                                            <div>
                                                <input type="checkbox" name="website" id="website">
                                                <label for="website">Website: ${{ user_steps.website.price }} USD -
                                                    monthly</label>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.toll_free_number %}
                                            <div>
                                                <input type="checkbox" name="toll_free_number" id="toll_free_number">
                                                <label for="toll_free">Toll Free Number:
                                                    ${{ user_steps.toll_free_number.price }} USD - monthly</label>
                                            </div>
                                            <div class="d-flex align-items-center justify-content-center">
                                                <div>
                                                    Toll Free NumberQuantity: <input class="quantity_input" value="1"
                                                                                     type="number" min="1"
                                                                                     name="toll_free_number_quantity"
                                                                                     id="toll_free_number_quantity">
                                                </div>
                                                <select class="custom-select mb-2" name="toll_free_number_prefix">
                                                    <option value="888 (Toll Free Prefix)">888 (Toll Free Prefix)
                                                    </option>
                                                    <option value="877 (Toll Free Prefix)">877 (Toll Free Prefix)
                                                    </option>
                                                    <option value="866 (Toll Free Prefix)">866 (Toll Free Prefix)
                                                    </option>
                                                    <option value="855 (Toll Free Prefix)">855 (Toll Free Prefix)
                                                    </option>
                                                    <option value="844 (Toll Free Prefix)">844 (Toll Free Prefix)
                                                    </option>
                                                    <option value="833 (Toll Free Prefix)">833 (Toll Free Prefix)
                                                    </option>
                                                    <option value="800 (Toll Free Prefix)">800 (Toll Free Prefix)
                                                    </option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.fax_number %}
                                            <div>
                                                <input type="checkbox" name="fax_number" id="fax_number">
                                                <label for="fax_number">Fax Number: ${{ user_steps.fax_number.price }}
                                                    USD - monthly</label>
                                            </div>
                                            <div class="d-flex align-items-center justify-content-center">
                                                <div>
                                                    Fax Number Quantity: <input class="quantity_input" value="1"
                                                                                type="number"
                                                                                min="1"
                                                                                name="fax_number_quantity"
                                                                                id="fax_number_quantity">
                                                </div>
                                                <select class="custom-select mb-2" name="fax_number_prefix">
                                                    <option value="888 (Toll Free Prefix)">888 (Toll Free Prefix)
                                                    </option>
                                                    <option value="877 (Toll Free Prefix)">877 (Toll Free Prefix)
                                                    </option>
                                                    <option value="866 (Toll Free Prefix)">866 (Toll Free Prefix)
                                                    </option>
                                                    <option value="855 (Toll Free Prefix)">855 (Toll Free Prefix)
                                                    </option>
                                                    <option value="844 (Toll Free Prefix)">844 (Toll Free Prefix)
                                                    </option>
                                                    <option value="833 (Toll Free Prefix)">833 (Toll Free Prefix)
                                                    </option>
                                                    <option value="800 (Toll Free Prefix)">800 (Toll Free Prefix)
                                                    </option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.domain %}
                                            <div>
                                                <input type="checkbox" name="domain" id="domain">
                                                <label for="domain">Domain: ${{ user_steps.domain.price }} USD</label>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.professional_email_address %}
                                            <div>
                                                <input type="checkbox" name="professional_email_address"
                                                       id="professional_email" disabled>
                                                <label for="professional_email">Professional Email Address:
                                                    ${{ user_steps.professional_email_address.price }} USD -
                                                    monthly</label>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.domain %}
                                            <div id="domain-field" style="display: none">
                                                <label for="domain_name">Domain name:</label>
                                                <div style="display: flex">
                                                    <input type="text" name="domain_name" id="domain_name">
                                                    <div>
                                                        <a class="btn btn-primary"
                                                           onclick="checkDomain('domain_name')">Check</a>
                                                    </div>

                                                </div>
                                                <div id="domain-statusdomain_name"></div>
                                            </div>

                                            <div>
                                                <label for="industry">Select Industry:</label><br>
                                                <select name="industry" id="industry" class="custom-select w-100">
                                                    <option>Electrician</option>
                                                    <option>Gardener</option>
                                                    <option>Tattoo Artist</option>
                                                    <option>Photography</option>
                                                    <option>Limo Service</option>
                                                    <option>Nutrition Advisor</option>
                                                    <option>Life Coach</option>
                                                    <option>Veterinary clinic</option>
                                                    <option>Laundromat</option>
                                                    <option>Fitness Club</option>
                                                    <option>Dentist</option>
                                                    <option>Consulting</option>
                                                    <option>Auto Repair</option>
                                                    <option>Tutor</option>
                                                    <option>Bakery</option>
                                                    <option>Financial Advisor</option>
                                                    <option>Lawyer</option>
                                                    <option>Marketing Agency</option>
                                                    <option>Trucking</option>
                                                    <option>Locksmith</option>
                                                    <option>Medical Clinic</option>
                                                    <option>Dance Studio</option>
                                                    <option>Carpenter</option>
                                                    <option>Moving Company</option>
                                                    <option>Hair Salon</option>
                                                    <option>Cleaning Service</option>
                                                    <option>Car Dealer</option>
                                                    <option>Portfolio</option>
                                                    <option>Real Estate</option>
                                                    <option>Preschool</option>
                                                    <option>Spa Services</option>
                                                    <option>Physical Therapist</option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.business_builder_program %}
                                            <div style="height: 1px; background-color: black" class="mt-3"></div>
                                            <div class=" my-2">
                                                Extra Bonuses If You Purchase All Options:
                                            </div>
                                            <div class="mb-2" style="font-size: 12px">

                                                &#8226; 60 days free on our accounting and payroll software <br>
                                                &#8226; 10% off our special auto dialer software that can do sms texting
                                                and
                                                voice broadcasting to grow your business for 60 days<br>
                                                &#8226; Free Access to our data platform that helps you get and export
                                                100,000 leads for 60 days<br>
                                                <!--  <a href="#">Watch video to explain bonuses</a> -->
                                            </div>
                                            <div class="text-center mb-2 font-weight-bold">
                                                Need All The Steps? Get The Business Builder Monthly Program for
                                                ${{ user_steps.business_builder_program.price }}
                                            </div>
                                            <div class="text-center">
                                                <input type="hidden" value="" name="business_builder_program"
                                                       id="business_builder_program">
                                                <button class="btn btn-primary" name="business_builder_program"
                                                        value="on"
                                                        form="business-programm">
                                                    Get Business
                                                    Builder Monthly Program
                                                </button>
                                            </div>
                                        {% endif %}

                                    </div>
                                </div>
                                <div class="card bg-gray m-2" style="width: 30rem;">
                                    <div class="card-body ">
                                        <div class="text-center mb-2 font-weight-bold">
                                            Yearly Options
                                        </div>

                                        {% if user_steps.website_year %}
                                            <div>
                                                <input type="checkbox" name="website_year" id="website_year">
                                                <label for="website_year">Website: ${{ user_steps.website_year.price }}
                                                    USD - yearly</label>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.toll_free_number_year %}
                                            <div>
                                                <input type="checkbox" name="toll_free_number_year"
                                                       id="toll_free_number_year">
                                                <label for="toll_free_year">Toll Free Number:
                                                    ${{ user_steps.toll_free_number_year.price }} USD - yearly</label>
                                            </div>

                                            <div class="d-flex align-items-center justify-content-center">
                                                <div>
                                                    Toll Free Number Quantity: <input class="quantity_input" value="1"
                                                                                      type="number" min="1"
                                                                                      name="toll_free_number_year_quantity"
                                                                                      id="toll_free_number_year_quantity">
                                                </div>
                                                <select class="custom-select mb-2" name="toll_free_number_year_prefix">
                                                    <option value="888 (Toll Free Prefix)">888 (Toll Free Prefix)
                                                    </option>
                                                    <option value="877 (Toll Free Prefix)">877 (Toll Free Prefix)
                                                    </option>
                                                    <option value="866 (Toll Free Prefix)">866 (Toll Free Prefix)
                                                    </option>
                                                    <option value="855 (Toll Free Prefix)">855 (Toll Free Prefix)
                                                    </option>
                                                    <option value="844 (Toll Free Prefix)">844 (Toll Free Prefix)
                                                    </option>
                                                    <option value="833 (Toll Free Prefix)">833 (Toll Free Prefix)
                                                    </option>
                                                    <option value="800 (Toll Free Prefix)">800 (Toll Free Prefix)
                                                    </option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.fax_number_year %}
                                            <div>
                                                <input type="checkbox" name="fax_number_year" id="fax_number_year">
                                                <label for="fax_number_year">Fax Number:
                                                    ${{ user_steps.fax_number_year.price }} USD - yearly</label>
                                            </div>

                                            <div class="d-flex align-items-center justify-content-center">
                                                <div>
                                                    Fax Number Quantity: <input class="quantity_input" value="1"
                                                                                type="number"
                                                                                min="1"
                                                                                name="fax_number_year_quantity"
                                                                                id="fax_number_year_quantity">
                                                </div>
                                                <select class="custom-select mb-2" name="fax_number_year_prefix">
                                                    <option value="888 (Toll Free Prefix)">888 (Toll Free Prefix)
                                                    </option>
                                                    <option value="877 (Toll Free Prefix)">877 (Toll Free Prefix)
                                                    </option>
                                                    <option value="866 (Toll Free Prefix)">866 (Toll Free Prefix)
                                                    </option>
                                                    <option value="855 (Toll Free Prefix)">855 (Toll Free Prefix)
                                                    </option>
                                                    <option value="844 (Toll Free Prefix)">844 (Toll Free Prefix)
                                                    </option>
                                                    <option value="833 (Toll Free Prefix)">833 (Toll Free Prefix)
                                                    </option>
                                                    <option value="800 (Toll Free Prefix)">800 (Toll Free Prefix)
                                                    </option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.domain_year %}
                                            <div>
                                                <input type="checkbox" name="domain_year" id="domain_year">
                                                <label for="domain_year">Domain: $13.99 USD</label>
                                            </div>
                                        {% endif %}
                                        {% if user_steps.professional_email_address_year %}
                                            <div>
                                                <input type="checkbox" disabled name="professional_email_address_year"
                                                       id="professional_email_year">
                                                <label for="professional_email_year">Professional Email Address:
                                                    ${{ user_steps.professional_email_address_year.price }} USD -
                                                    yearly</label>
                                            </div>
                                        {% endif %}
                                        {% if user_steps.domain_year %}
                                            <div id="domain-year-field" style="display: none">
                                                <label for="domain_name_year">Domain name:</label>
                                                <div style="display: flex">
                                                    <input type="text" name="domain_name_year" id="domain_name_year">
                                                    <div>
                                                        <a class="btn btn-primary"
                                                           onclick="checkDomain('domain_name_year')">Check</a>
                                                    </div>

                                                </div>
                                                <div id="domain-statusdomain_name_year"></div>
                                            </div>

                                            <div>
                                                <label for="industry_year">Select Industry:</label><br>
                                                <select name="industry_year" id="industry_year"
                                                        class="custom-select w-100">
                                                    <option>Electrician</option>
                                                    <option>Gardener</option>
                                                    <option>Tattoo Artist</option>
                                                    <option>Photography</option>
                                                    <option>Limo Service</option>
                                                    <option>Nutrition Advisor</option>
                                                    <option>Life Coach</option>
                                                    <option>Veterinary clinic</option>
                                                    <option>Laundromat</option>
                                                    <option>Fitness Club</option>
                                                    <option>Dentist</option>
                                                    <option>Consulting</option>
                                                    <option>Auto Repair</option>
                                                    <option>Tutor</option>
                                                    <option>Bakery</option>
                                                    <option>Financial Advisor</option>
                                                    <option>Lawyer</option>
                                                    <option>Marketing Agency</option>
                                                    <option>Trucking</option>
                                                    <option>Locksmith</option>
                                                    <option>Medical Clinic</option>
                                                    <option>Dance Studio</option>
                                                    <option>Carpenter</option>
                                                    <option>Moving Company</option>
                                                    <option>Hair Salon</option>
                                                    <option>Cleaning Service</option>
                                                    <option>Car Dealer</option>
                                                    <option>Portfolio</option>
                                                    <option>Real Estate</option>
                                                    <option>Preschool</option>
                                                    <option>Spa Services</option>
                                                    <option>Physical Therapist</option>
                                                </select>
                                            </div>
                                        {% endif %}

                                        {% if user_steps.business_builder_program_year %}
                                            <div style="height: 1px; background-color: black" class="mt-3"></div>
                                            <div class=" my-2">
                                                Extra Bonuses If You Purchase All Options:
                                            </div>
                                            <div class="mb-2" style="font-size: 12px">


                                                &#8226; 1 year free on our accounting and payroll software<br>
                                                &#8226; 50% off our special auto dialer software that can do sms texting
                                                and
                                                voice
                                                broadcasting to grow your business for 60 days<br>
                                                &#8226; Free Access to our data platform that helps you get and export
                                                100,000 leads for 120 days<br>
                                                <!--  <a href="#">Watch video to explain bonuses</a> -->

                                            </div>
                                            <div class="text-center mb-2 font-weight-bold">
                                                Need All The Steps? Get The Business Builder Annual Program for
                                                ${{ user_steps.business_builder_program_year.price }} and
                                                save $50
                                            </div>
                                            <div class="text-center ">
                                                <input type="hidden" value="" name="business_builder_program_year"
                                                       id="business_builder_program_year">
                                                <button class="btn btn-primary" name="business_builder_program_year"
                                                        form="business_builder_program_year_form"
                                                        value="on">
                                                    Get Business Builder Annual Program
                                                </button>
                                            </div>
                                        {% endif %}

                                    </div>
                                </div>
                            </div>

                            <div class="row justify-content-center">
                                <div class="col text-center mt-4" id="stripe-form">
                                    <div>Total: $<span id="total_amount">0</span></div>
                                    <button type="submit" class="btn btn-primary">Proceed to checkout</button>
                                </div>

                            </div>

                        </form>
                    </div>
                </div>
            </div>


        </section>
    </div>

    <style media="screen">
        .room {
            margin-bottom: 10%;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>

        $('#steps-form').on('change', calculateAmount)

        $('#steps-form').submit(async function (evt) {
            evt.preventDefault();
            if (document.getElementById('domain_year').checked && await checkDomain('domain_name_year')) {
                this.submit();
            } else if (document.getElementById('domain').checked && await checkDomain('domain_name')) {
                this.submit();
            }
            if (!document.getElementById('domain_year').checked && !document.getElementById('domain').checked) {
                this.submit();
            }

        })

        $('#business-programm').submit(async function (evt) {
            evt.preventDefault();
            document.getElementById('business_builder_program').value = "on";
            validateFormAndSubmit()
        });

        $('#business_builder_program_year_form').submit(async function (evt) {
            evt.preventDefault();
            document.getElementById('business_builder_program_year').value = "on";
            validateFormAndSubmit()
        });

        function validateFormAndSubmit() {
            var form = $('#steps-form');
            var isValid = true;
            for (let input of form[0].elements) {
                isValid = input.reportValidity()
                if (!isValid) break
            }
            if (isValid) {
                form.submit()
            }
        }

        async function checkDomain(form_id) {
            var formData = new FormData();
            formData.append('domain', document.getElementById(form_id).value)
            var response = await fetch('{% url "check_domain" %}', {
                method: 'POST',
                body: formData
            })
            var data = await response.json()

            if (data.status === 'true') {
                document.getElementById('domain-status' + form_id).innerHTML = document.getElementById(form_id).value + " is available."
                document.getElementById('domain-status' + form_id).style.color = 'inherit'
                return true
            } else {
                document.getElementById('domain-status' + form_id).innerHTML = data.error
                document.getElementById('domain-status' + form_id).style.color = 'red'
                return false
            }
        }

        var prices = {
            {% for item, data in user_steps.items %}
                "{{ item }}": {{ data.price }},
            {% endfor %}
        }

        function calculateAmount() {
            var total = 0
            console.log(1, total)
            for (let [key, value] of Object.entries(prices)) {
                var el = document.getElementById(key);
                if (el && el.checked) {

                    if (key === "toll_free_number") {
                        total += value * Number(document.getElementById('toll_free_number_quantity').value)
                        console.log(2, total)
                    } else if (key === "toll_free_number_year") {
                        total += value * Number(document.getElementById('toll_free_number_year_quantity').value)
                        console.log(3, total)
                    } else if (key === "fax_number") {
                        total += value * Number(document.getElementById('fax_number_quantity').value)
                        console.log(4, total)
                    } else if (key === "fax_number_year") {
                        total += value * Number(document.getElementById('fax_number_year_quantity').value)
                        console.log(5, total)
                    } else {
                        total += value
                        console.log(6, total)
                    }
                    console.log(7, total, key, value, Number(document.getElementById('toll_free_number_quantity').value));

                }
            }
            $("#total_amount").html(round(total))
        }

        function round(amount) {
            var rounded = Math.round(amount * 100) / 100
            return rounded
        }

        $("#domain_year").on('change', (event) => {
            var field = document.getElementById('domain-year-field')
            if (event.target.checked) {
                field.style.display = 'block'
                document.getElementById('professional_email_year').disabled = false
            } else {
                field.style.display = 'none'
                document.getElementById('professional_email_year').disabled = true
                document.getElementById('professional_email_year').checked = false
            }
        });

        $("#domain").on('change', (event) => {
            var field = document.getElementById('domain-field')
            if (event.target.checked) {
                field.style.display = 'block'
                document.getElementById('professional_email').disabled = false
            } else {
                field.style.display = 'none'
                document.getElementById('professional_email').disabled = true
                document.getElementById('professional_email').checked = false
            }
        });

        calculateAmount()
    </script>

{% endblock %}
